<!DOCTYPE html>
<html>
  <head>
    <title>Direct Whatsapp Connect</title>
    <meta charset="utf-8" />
    <meta http-equiv="x-ua-compatible" content="ie=edge" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />

    <meta name="robots" content="noindex, nofollow" />

    <link rel="shortcut icon" href="https://directwhatsapp.net/icon.png" />

    <link rel="manifest" href="https://directwhatsapp.net/manifest.json" />

    <style type="text/css">
      html {
        box-sizing: border-box;
        font-family: -apple-system, BlinkMacSystemFont, Segoe UI, Roboto, Oxygen,
          Ubuntu, Cantarell, Fira Sans, Droid Sans, Helvetica Neue, sans-serif;
        font-weight: 400;
        font-style: normal;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
      }

      body {
        background-color: #1ebea5;
        color: #fff;
      }

      .bg-button-green {
        background-color: #01e675;
      }

      h1,
      h2,
      h3,
      h4,
      h5 {
        font-weight: 400;
      }

      #anchorButton {
        display: none;
      }

      .wrapper {
        max-width: 600px;
        margin: 0 auto;
        padding-left: 20px;
        padding-right: 20px;
      }

      .inputStyleFull {
        width: 100%;
        display: block;
        font-size: 16px;
        padding-top: 10px;
        padding-bottom: 10px;
      }

      .t-xs {
        font-size: 10px;
      }

      .t-sm {
        font-size: 13px;
      }

      .t-mid {
        font-size: 16px;
      }

      .t-lg {
        font-size: 19px;
      }

      .t-xl {
        font-size: 24px;
      }

      .dfx {
        display: flex;
      }

      .dfx .textField {
        flex: 1;
      }

      .dfx .countryCode {
        width: 100px;
      }

      #installButton {
        padding: 10px 20px;
      }
    </style>
  </head>
  <body>
    <div class="wrapper">
      <h1>Direct Whatsapp</h1>

      <p class="t-md">Progress : Added Installation steps</p>

      <button id="installButton" style="display: none">
        Add to Home Screen
      </button>

      <h2 id="outputNumber"></h2>

      <form name="buildWhatsapplink" id="buildWhatsapplink" method="post">
        <label class="t-lg">Add Country Code and WhatsApp Number</label>
        <input
          class="inputStyleFull"
          type="tel"
          name="contactnumber"
          id="contactnumber"
          placeholder="contactnumber"
        />
      </form>

      <div>
        <a href="" target="blank" id="anchorButton" class="bg-button-green">
          <span>Direct WhatsApp</span>
          <img src="icon.svg" />
        </a>
      </div>

      <p class="t-lg">
        This tiny application will let you quickly send text, audio message or
        call to any valid whatsapp number from your smartphone without being in
        your contact list
      </p>
    </div>

    <script type="text/javascript">
      if ("serviceWorker" in navigator) {
        window.addEventListener("load", () => {
          navigator.serviceWorker
            .register("/service-worker.js")
            .then((registration) => {
              console.log(
                "Service Worker registered with scope:",
                registration.scope
              );
            })
            .catch((error) => {
              console.log("Service Worker registration failed:", error);
            });
        });
      }
    </script>

    <script type="text/javascript">
      let deferredPrompt;

      window.addEventListener("beforeinstallprompt", (e) => {
        // Prevent the mini-infobar from appearing on mobile
        e.preventDefault();
        // Stash the event so it can be triggered later.
        deferredPrompt = e;
        // Show the install button (log for debugging)
        console.log("Install prompt is ready");
        document.querySelector("#installButton").style.display = "block";
      });

      document
        .querySelector("#installButton")
        .addEventListener("click", (e) => {
          // Hide the install button
          e.target.style.display = "none";
          // Show the prompt
          deferredPrompt.prompt();
          // Wait for the user to respond to the prompt
          deferredPrompt.userChoice.then((choiceResult) => {
            if (choiceResult.outcome === "accepted") {
              console.log("User accepted the A2HS prompt");
            } else {
              console.log("User dismissed the A2HS prompt");
            }
            deferredPrompt = null;
          });
        });

      var triggerButton = document.getElementById("triggerButton");

      var inputTel = document.getElementById("contactnumber");

      var anchorButton = document.getElementById("anchorButton");

      var outputNumber = document.getElementById("outputNumber");

      inputTel.addEventListener("keyup", function (e) {
        e.target.value;

        var inputvalue = e.target.value;

        outputNumber.innerText = inputvalue;

        if (inputvalue.length > 10) {
          /*
			https://api.whatsapp.com/send?phone=923121006348
			*/
          var basePath = "https://api.whatsapp.com/send?phone=";
          var targetNumber = inputvalue;
          var targetPathUrl = basePath + targetNumber;
          anchorButton.setAttribute("href", targetPathUrl);

          anchorButton.style.display = "inline-block";
        } else {
          anchorButton.style.display = "none";
        }
      });

      // Listen for the input event
      inputTel.addEventListener("input", function () {
        let sanitizedValue = inputTel.value.replace(/[^0-9]/g, "");
        // Update the input field value with the sanitized value
        inputTel.value = sanitizedValue;
      });
    </script>
  </body>
</html>
